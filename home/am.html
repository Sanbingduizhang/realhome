<div class="amall">
    <div class="ambk">
        <div class="amhead">
            <div class="amhead-top">文章相关</div>
            <div>
                <div class="amhead-left">
                    <span class="amhead-add">添加</span>
                    <span  class="amhead-del">删除</span>
                </div>
                <div class="amhead-mid">
                    <span  class="amhead-ypu">已发布</span>
                    <span  class="amhead-npu">未发布</span>
                    <span  class="amhead-yrec">已推荐</span>
                    <span  class="amhead-nrec">未推荐</span>
                    <span  class="amhead-yshen">已审核</span>
                    <span  class="amhead-nshen">未审核</span>

                </div>
                <div class="amhead-right">
                    <input type="text" name="" id="amss">
                    <span  class="amhead-ss">搜索</span>
                </div>
            </div>
        </div>
        <div class="amcontents">
            <table class="amtable" border="1" cellspacing="0">
                <thead>
                    <tr>
                        <th><input type="checkbox" name="" id=""></th>
                        <th>相关内容</th>
                        <th>所属分类</th>
                        <th>是否发布</th>
                        <th>是否推荐</th>
                        <th>点赞人数</th>
                        <th>观看人数</th>
                        <th>审核状态</th>
                        <th>相关操作</th>
                    </tr>
                </thead>
                <tbody class="tb-contents">
                    <!--<tr>
                        <td><input type="checkbox" name="" id=""></td>
                        <td>$相关内容</td>
                        <td>相关内容</td>
                        <td>$相关内容</td>
                        <td>相关内容</td>
                        <td>$相关内容</td>
                        <td>相关内容</td>
                        <td>未审</td>
                        <td><span>上架</span><span>删除</span></td>
                    </tr> -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="9">
                            <div class="M-box1 all-style all-box"></div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
<script>
    (function () {
        //table数据填充
        function tablestr(data) {
            var str = '';
            var len = data.data.data.length;
            if (len == 0) {
                return '<tr><td colspan="9">暂无数据</div></td></tr>';
            }
            var tbs = data.data.data;
            for (var i = 0; i < len; i++) {
                str += '<tr arid="' + tbs[i].id + '">' +
                    '<td><input type="checkbox" id="check-all-ar"></td>' +
                    '<td title="' + tbs[i].content + '">' + tbs[i].content.substring(0, 18) + '...</td>' +
                    '<td>' + tbs[i].article_cate + '</td>' +
                    '<td>' + tbs[i].publish + '</td>' +
                    '<td>' + tbs[i].is_rec + '</td>' +
                    '<td>' + tbs[i].like + '</td>' +
                    '<td>' + tbs[i].pv + '</td>' +
                    '<td>' + tbs[i].status + '</td>' +
                    '<td><span class="sxj">' + tbs[i].sxj + '</span><span class="amdel">删除</span></td>' +
                    '</tr>';
            }
            return str;
        }

        var realToken = getRealToken();
        if (realToken == undefined || realToken == '' || realToken == null) {
            console.log(realToken);
        } else {
            indexar(realToken);
        }

        //删除操作--删除单条的逻辑
        $(".tb-contents").on('click', '.amdel', function () {
            //获取当前这一条数据的id
            var arid = $(this).parent().parent().attr('arid');
            var idarr = new Array(arid);
            del(idarr);
        });
        //删除操作--选择多条删除



        //删除操作方法
        function del(idArr) {
            if (realToken == undefined || realToken == '' || realToken == null) {
                console.log('用户登录有误');
            } else {
                $.ajax({
                    type: "POST",
                    url: getBaseUri() + "api/admin/ar/del",
                    dataType: "json",
                    data: {
                        'idArr': idArr,
                    },
                    headers: {
                        Authorization: 'Bearer ' + realToken,
                    },
                    success: function (response) {
                        indexar(realToken);
                        alert('删除成功');
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            }
        }
        //显示操作方法
        function indexar(realToken) {
            $.ajax({
                type: "GET",
                url: getBaseUri() + "api/admin/index",
                dataType: "json",
                data: {
                },
                headers: {
                    Authorization: 'Bearer ' + realToken,
                },
                success: function (response) {
                    var tbstr = tablestr(response);
                    $(".tb-contents").html(tbstr);
                    var yema = response.data.pagination;
                    $('.all-box').pagination({
                        pageCount: yema.total_page,
                        showData: yema.per_page,
                        current: yema.current_page,
                        coping: true,
                        // pageCount: yema.total_page,
                        // showData: yema.per_page,
                        // current: yema.current_page,
                        // mode: 'fixed',
                        callback: function (api) {
                            $.ajax({
                                type: "GET",
                                url: getBaseUri() + "api/admin/index?page=" + api.getCurrent(),
                                dataType: "json",
                                headers: {
                                    Authorization: 'Bearer ' + realToken,
                                },
                                data: {

                                },
                                success: function (data) {
                                    var tbstr = tablestr(data);
                                    $(".tb-contents").html(tbstr);
                                },
                                error: function (jqXHR) {
                                    console.log(jqXHR);
                                }
                            });
                        },
                    });
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
    })();
</script>